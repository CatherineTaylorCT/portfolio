---
title: "River water samples"
author: "Catherine Taylor"
date: "2024-08-07"
output: html_document
---
### CRAP: Colne River Assessment Project.

#### This data was collected by Volunteers, myself,  Drew Henderson, and Rob Furguson, a lecturer at the University of Essex, who is leading the project.

#### (No date) Colne River Action Plan (CRAP). Available at: https://epigenetics.essex.ac.uk/shiny/crap/ (Accessed: 23 August 2024). 

#### Introduction- The Colne River Assessment Project (CRAP) is an ongoing initiative focused on monitoring and assessing the biodiversity and water quality in various waterways across East Essex and Suffolk. Over the past year, the project collected water samples from key water bodies, including the Colne, Stour, Hythe, and Tollesbury rivers. These samples were analyzed to evaluate the levels of E. coli, Enterococcus, and antimicrobial-resistant bacteria (AMR) such as Extended-Spectrum Beta-Lactamase (ESBL) and Vancomycin-Resistant Enterococci (VRE). The project involved volunteers and experts like Drew Henderson and Rob Furguson from the University of Essex. The primary goal was to understand how environmental factors, particularly tide conditions, impact bacterial contamination and to compare the microbial levels against UK inland bathing water standards.

```{R}
# Install necessary packages
install.packages("googlesheets4")
install.packages("googledrive")
install.packages("ggplot2")
install.packages("dplyr")

# Load libraries
library(googlesheets4)
library(googledrive)
library(ggplot2)
library(dplyr)

# Load the necessary libraries
library(googlesheets4)

# De-authenticate to allow access to public sheets
gs4_deauth()

# Load the data from the public Google Sheets URL
data <- read_sheet(
  "https://docs.google.com/spreadsheets/d/1Z1qwWgIIq1m1TmJi9HJ0JDe69xZCJkABx05OdabkYF8/edit?usp=sharing",
  col_names = TRUE,
  na = c("NC", "NA"),  # Optional: Replace "NC" or "NA" with proper NAs
  range = "A:W"  # Optional: Specify range if necessary
)

# Display the first few rows of the data
head(data)

```
```{R}
# Load the data from Google Sheets
# Ensure you have permission to access this sheet or shared properly
data <- read_sheet(
  "https://docs.google.com/spreadsheets/d/1Z1qwWgIIq1m1TmJi9HJ0JDe69xZCJkABx05OdabkYF8/edit?usp=sharing",
  col_names = TRUE,
  na = c("NC", "NA"),
  range = "A:W"
)

# Display the first few rows of the data to inspect
head(data)

```
```{R}
# Select specific columns and exclude "highTide (hh:mm)"
data <- read_sheet("https://docs.google.com/spreadsheets/d/1Z1qwWgIIq1m1TmJi9HJ0JDe69xZCJkABx05OdabkYF8/edit?usp=sharing", col_names = TRUE, na = c("NC", "NA"), range = "A:W")

data <- data %>% dplyr::select(!"highTide (hh:mm)")

# Display the first few rows to inspect the data structure
head(data)

# Print column names
names(data)

# Print entire dataset to console (useful for debugging)
print(data)

# View data in a spreadsheet-like viewer in RStudio
View(data)
```
```{R}
# Data cleaning and transformation
data_cleaned <- data %>%
  # Convert date to Date format
  mutate(`dateCollected (dd/mm/yy)` = as.Date(`dateCollected (dd/mm/yy)`, format = "%d/%m/%y")) %>%
  # Convert time to POSIXct for accurate time handling
  mutate(`timeCollected (hh:mm)` = as.POSIXct(`timeCollected (hh:mm)`, format = "%H:%M")) %>%
  # Convert bacteria counts to numeric for statistical analysis
  mutate(across(c(`E.coli`, `TotalColiforms`, entericEnterococci, ESBL, VRE), as.numeric)) %>%
  # Create a factor column for tide phases with correct levels
  mutate(tide = factor(tide, levels = c("ebb", "flood", "slack", "NA")),
         Waterway = as.factor(Waterway)) %>%
  # Filter out rows where Waterway is NA
  filter(!is.na(Waterway))

# Boxplot for Total Coliforms, grouped by tide and waterway
ggplot(data_cleaned, aes(x = tide, y = `TotalColiforms`, fill = Waterway)) +
  geom_boxplot() +
  geom_jitter(aes(color = Waterway), width = 0.2) +
  labs(
    title = "Comparison of Total Coliforms by Tide and Waterway",
    x = "Tide Condition",
    y = "Total Coliforms (cfu/100ml)"
  ) +
  theme_minimal()

# Plot for VRE levels, grouped by tide and waterway
ggplot(data_cleaned, aes(x = tide, y = VRE, fill = Waterway)) +
  geom_boxplot() +
  geom_jitter(aes(color = Waterway), width = 0.2) +
  labs(
    title = "Comparison of VRE by Tide and Waterway",
    x = "Tide Condition",
    y = "VRE Levels"
  ) +
  theme_minimal()

# Plot for ESBL levels, grouped by tide and waterway
ggplot(data_cleaned, aes(x = tide, y = ESBL, fill = Waterway)) +
  geom_boxplot() +
  geom_jitter(aes(color = Waterway), width = 0.2) +
  labs(
    title = "Comparison of ESBL by Tide and Waterway",
    x = "Tide Condition",
    y = "ESBL Levels"
  ) +
  theme_minimal()

# Plot for E. coli levels, grouped by tide and waterway
ggplot(data_cleaned, aes(x = tide, y = `E.coli`, fill = Waterway)) +
  geom_boxplot() +
  geom_jitter(aes(color = Waterway), width = 0.2) +
  labs(
    title = "Comparison of E. coli Levels by Tide and Waterway",
    x = "Tide Condition",
    y = "E. coli (cfu/100ml)"
  ) +
  theme_minimal()

# Plot for Enterococci levels, grouped by tide and waterway
ggplot(data_cleaned, aes(x = tide, y = entericEnterococci, fill = Waterway)) +
  geom_boxplot() +
  geom_jitter(aes(color = Waterway), width = 0.2) +
  labs(
    title = "Comparison of Enteric Enterococci Levels by Tide and Waterway",
    x = "Tide Condition",
    y = "Enteric Enterococci (cfu/100ml)"
  ) +
  theme_minimal()
```
#### Figures 1, 2, 3, 4, 5. This multi-figure set illustrates the comparative concentrations of various bacterial contaminants, including Total Coliforms, VRE (Vancomycin-Resistant Enterococci), ESBL (Extended Spectrum Beta-Lactamase), E. coli, and Enteric Enterococci, across four waterways (Blackwater, Colne, Roman, Stour) under different tide conditions (ebb, flood, slack, and NA). All data are presented as cfu/100ml (colony-forming units per 100 milliliters). The tidal phases represent different stages of water movement that impact bacterial concentrations, and the waterways are color-coded: Blackwater (red), Colne (green), Roman (blue), Stour (purple), and NA (black) for unspecified or unidentified waterways. The figures show distinct patterns of contamination. Colne had the highest Total Coliforms during flood tide, with lower concentrations in Blackwater and Stour, while Roman showed minimal variability. VRE concentrations were highest in Stour during ebb tide, followed by Colne and Blackwater during flood, with Roman consistently lower. ESBL levels peaked in Blackwater during flood tide, with moderate contamination in Colne and lower levels in Roman and Stour. E. coli concentrations were highest in Stour during slack tide, with moderate contamination in Colne and consistently lower levels in Blackwater and Roman. Enteric Enterococci levels were elevated in Blackwater during flood tide and in Stour during slack tide, while Colne and Roman remained lower throughout. These results indicate that Colne and Stour tend to exhibit higher bacterial levels across categories, particularly during slack and flood tides. The presence of antibiotic-resistant bacteria (VRE and ESBL) underscores the environmental and public health concerns associated with these waterways. This combined legend contextualizes the figures, linking bacterial contamination to waterway and tide conditions.

```{R}
# Filter out NA values for Waterway column
data_filtered <- data %>% filter(!is.na(Waterway))

# Plot E. coli levels by tide and waterway with thresholds and annotations using the filtered data
ggplot(data_filtered, aes(x = tide, y = `E.coli`, fill = Waterway)) +
  geom_boxplot(outlier.shape = 21, outlier.fill = "black", outlier.size = 2) +
  scale_y_log10() +  # Logarithmic scale for better visualization
  geom_hline(yintercept = 200, linetype = "dashed", color = "green", size = 1) +   # Excellent threshold
  geom_hline(yintercept = 400, linetype = "dashed", color = "blue", size = 1) +    # Good threshold
  geom_hline(yintercept = 600, linetype = "dashed", color = "orange", size = 1) +  # Sufficient threshold
  geom_hline(yintercept = 1000, linetype = "dashed", color = "red", size = 1) +    # Poor threshold
  
  # Add text annotations for thresholds
  annotate("text", x = 4.8, y = 200, label = "Excellent", color = "green", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 400, label = "Good", color = "blue", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 600, label = "Sufficient", color = "orange", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 1000, label = "Poor", color = "red", hjust = 1, size = 5, fontface = "bold") +
  
  # Set labels and theme options
  labs(title = "E. coli Levels by Tide Phase and Waterway",
       y = "E. coli (cfu/100ml)",
       x = "Tide Phase",
       fill = "Waterway") +
  scale_fill_manual(values = c("Blackwater" = "salmon", 
                               "Colne" = "green3", 
                               "Roman" = "purple", 
                               "Stour" = "blue")) +  # Removed NA from custom colors for waterways
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate tide labels for better visibility
        plot.title = element_text(size = 16),               # Adjust title size
        axis.title = element_text(size = 14),               # Adjust axis label size
        legend.title = element_text(size = 12),             # Adjust legend title size
        legend.text = element_text(size = 10))              # Adjust legend text size
```
#### Figure 6. This figure shows the E. coli levels (cfu/100ml) across different waterways (Blackwater, Colne, Roman, Stour, and NA) during various tidal phases (ebb, flood, slack, and NA). The waterways are represented by different colors: Blackwater (red), Colne (green), Roman (purple), Stour (blue), and NA (grey). The graph uses a logarithmic scale to better visualize the wide range of bacterial concentrations. Dashed horizontal lines indicate water quality thresholds: Excellent (green, 250 cfu/100ml), Good (blue, 500 cfu/100ml), Sufficient (orange, 600 cfu/100ml), and Poor (red, 1000+ cfu/100ml). Stour shows notably high E. coli levels during slack tide, while Colne has moderate levels. Both Roman and Blackwater exhibit lower contamination across all tidal phases. 

```{R}
# Filter out NA values for Waterway column
data_filtered <- data %>% filter(!is.na(Waterway))

# Updated ggplot code using the filtered data
ggplot(data_filtered, aes(x = tide, y = `TotalColiforms`, fill = Waterway)) +
  geom_boxplot(outlier.shape = 21, outlier.fill = "black", outlier.size = 2) +
  scale_y_log10() +  # Logarithmic scale
  geom_hline(yintercept = 200, linetype = "dashed", color = "green", size = 1) +   # Excellent threshold
  geom_hline(yintercept = 400, linetype = "dashed", color = "blue", size = 1) +    # Good threshold
  geom_hline(yintercept = 600, linetype = "dashed", color = "orange", size = 1) +  # Sufficient threshold
  geom_hline(yintercept = 1000, linetype = "dashed", color = "red", size = 1) +    # Poor threshold
  
  annotate("text", x = 4.8, y = 200, label = "Excellent", color = "green", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 400, label = "Good", color = "blue", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 600, label = "Sufficient", color = "orange", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 1000, label = "Poor", color = "red", hjust = 1, size = 5, fontface = "bold") +
  
  labs(title = "Total Coliforms Levels by Tide Phase and Waterway",
       y = "Total Coliforms (cfu/100ml)",
       x = "Tide Phase",
       fill = "Waterway") +
  scale_fill_manual(values = c("Blackwater" = "salmon", 
                               "Colne" = "green3", 
                               "Roman" = "purple", 
                               "Stour" = "blue")) +  # NA removed from the fill scale
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(size = 16),
        axis.title = element_text(size = 14),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))
```
#### Figure 7.This figure presents Total Coliform levels (cfu/100ml) across different waterways (Blackwater, Colne, Roman, Stour, and NA) during varying tidal phases (ebb, flood, slack, and NA). The waterways are distinguished by colors: Blackwater (red), Colne (green), Roman (purple), Stour (blue), and NA (grey). A logarithmic scale is used for the vertical axis to accommodate a wide range of bacterial concentrations. The dashed horizontal lines mark water quality thresholds: Excellent (green, 250 cfu/100ml), Good (blue, 500 cfu/100ml), Sufficient (orange, 600 cfu/100ml), and Poor (red, 1000+ cfu/100ml). Colne consistently exhibits higher Total Coliform levels, particularly during ebb tide, while other waterways, such as Blackwater and Roman, display lower concentrations. Total Coliform levels generally stay within or near the thresholds for Good or Sufficient quality across most waterways and tide phases, except for a few outliers above the Poor threshold.

```{R}
# Load ggplot2 for plotting and dplyr for data manipulation
ggplot(data, aes(x = tide, y = ESBL, fill = Waterway)) +
  
  # Create a boxplot with formatted outliers
  geom_boxplot(outlier.shape = 21, outlier.fill = "black", outlier.size = 2) +
  
  # Apply logarithmic scale to y-axis to manage data spread
  scale_y_log10() +  
  
  # Add horizontal lines to show thresholds for water quality
  geom_hline(yintercept = 200, linetype = "dashed", color = "green", size = 1) +   # Excellent threshold
  geom_hline(yintercept = 400, linetype = "dashed", color = "blue", size = 1) +    # Good threshold
  geom_hline(yintercept = 600, linetype = "dashed", color = "orange", size = 1) +  # Sufficient threshold
  geom_hline(yintercept = 1000, linetype = "dashed", color = "red", size = 1) +    # Poor threshold
  
  # Annotate the threshold lines with text
  annotate("text", x = 4.8, y = 200, label = "Excellent", color = "green", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 400, label = "Good", color = "blue", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 600, label = "Sufficient", color = "orange", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 1000, label = "Poor", color = "red", hjust = 1, size = 5, fontface = "bold") +
  
  # Set plot labels for title, y-axis, and x-axis
  labs(title = "ESBL Levels by Tide Phase and Waterway",
       y = "ESBL (cfu/100ml)",
       x = "Tide Phase",
       fill = "Waterway") +
  
  # Custom colors for each waterway
  scale_fill_manual(values = c("Blackwater" = "salmon", 
                               "Colne" = "green3", 
                               "Roman" = "purple", 
                               "Stour" = "blue", 
                               "NA" = "grey")) +
  
  # Apply minimal theme and rotate x-axis labels
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(size = 16),     # Set plot title size
        axis.title = element_text(size = 14),     # Set axis title size
        legend.title = element_text(size = 12),   # Set legend title size
        legend.text = element_text(size = 10))    # Set legend text size
```
#### Figure 8. This figure shows ESBL (Extended Spectrum Beta-Lactamase) bacterial levels (cfu/100ml) across various waterways—Blackwater (red), Colne (green), Roman (purple), and Stour (blue)—during different tide phases (ebb, flood, slack, and NA). The chart uses a logarithmic scale to illustrate a wide range of bacterial concentrations. Dashed horizontal lines represent water quality thresholds: Excellent (green, 250 cfu/100ml), Good (blue, 500 cfu/100ml), Sufficient (orange, 600 cfu/100ml), and Poor (red, 1000+ cfu/100ml). ESBL levels are highest in Blackwater during ebb tide, with Colne also showing elevated levels, particularly during flood tide. Roman and Stour have lower ESBL concentrations, often falling within the thresholds for Excellent or Good quality.

```{R}
ggplot(data, aes(x = tide, y = ESBL, fill = Waterway)) +
  geom_boxplot(outlier.shape = 21, outlier.fill = "black", outlier.size = 2) +
  scale_y_log10() +  # Logarithmic scale
  geom_hline(yintercept = 200, linetype = "dashed", color = "green", size = 1) +   # Excellent threshold
  geom_hline(yintercept = 400, linetype = "dashed", color = "blue", size = 1) +    # Good threshold
  geom_hline(yintercept = 600, linetype = "dashed", color = "orange", size = 1) +  # Sufficient threshold
  geom_hline(yintercept = 1000, linetype = "dashed", color = "red", size = 1) +    # Poor threshold
  
  annotate("text", x = 4.8, y = 200, label = "Excellent", color = "green", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 400, label = "Good", color = "blue", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 600, label = "Sufficient", color = "orange", hjust = 1, size = 5, fontface = "bold") +
  annotate("text", x = 4.8, y = 1000, label = "Poor", color = "red", hjust = 1, size = 5, fontface = "bold") +
  
  labs(title = "ESBL Levels by Tide Phase and Waterway",
       y = "ESBL (cfu/100ml)",
       x = "Tide Phase",
       fill = "Waterway") +
  scale_fill_manual(values = c("Blackwater" = "salmon", 
                               "Colne" = "green3", 
                               "Roman" = "purple", 
                               "Stour" = "blue", 
                               "NA" = "grey")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(size = 16),
        axis.title = element_text(size = 14),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))
```
#### Figure 9. This graph displays the levels of ESBL (Extended Spectrum Beta-Lactamase) bacteria across different waterways (Blackwater, Colne, Roman, and Stour) during various tidal phases (ebb, flood, slack, and NA). The bacterial concentrations are measured in cfu/100ml. The horizontal dashed lines represent water quality thresholds: Excellent (green, 250 cfu/100ml), Good (blue, 500 cfu/100ml), Sufficient (orange, 600 cfu/100ml), and Poor (red, above 1000 cfu/100ml). ESBL levels are highest in Blackwater during the ebb tide, with the flood tide in the Colne waterway also showing elevated levels that approach the Poor threshold. Roman and Stour waterways generally exhibit lower ESBL levels. 

```{R}
# Convert date and time columns to appropriate types
data$`dateCollected (dd/mm/yy)` <- as.Date(data$`dateCollected (dd/mm/yy)`, format = "%d/%m/%y")
data$`timeCollected (hh:mm)` <- as.POSIXct(data$`timeCollected (hh:mm)`, format = "%H:%M")

# Extract and order months
data$month <- format(data$`dateCollected (dd/mm/yy)`, "%B")
data$month <- factor(data$month, levels = c("July", "August", "September", "October", "November", "December", "January", "February", "March", "April", "May", "June"))

# Convert bacteria columns to numeric
data <- data %>%
  mutate(across(c(`E.coli`, `TotalColiforms`, entericEnterococci, ESBL, VRE), as.numeric))

# Remove unnecessary columns
data <- data %>%
  select(-c(`TimeSinceHighTide (hh:mm)`, `PlusCode`, notes))

```
```{R}
# Summary statistics for bacterial concentrations
summary_stats <- data %>%
  summarise(
    E.coli_mean = mean(`E.coli`, na.rm = TRUE),
    entericEnterococci_mean = mean(entericEnterococci, na.rm = TRUE),
    ESBL_mean = mean(ESBL, na.rm = TRUE),
    VRE_mean = mean(VRE, na.rm = TRUE), 
    TotalColiforms_mean = mean(TotalColiforms, na.rm = TRUE),
    ColiformsNonEC_mean = mean(ColiformsNonEC, na.rm = TRUE)
  )

summary_stats

```
```{R}
# Average concentrations by Waterway
average_concentrations <- data %>%
  group_by(Waterway) %>%
  summarise(
    Avg_E.coli = mean(`E.coli`, na.rm = TRUE),
    Avg_Enterococci = mean(entericEnterococci, na.rm = TRUE),
    Avg_ESBL = mean(ESBL, na.rm = TRUE),
    Avg_VRE = mean(VRE, na.rm = TRUE)
  )

# Display the result
average_concentrations
# Define thresholds
ec_thresholds <- c(Excellent = 250, Good = 500, Sufficient = 500, Poor = Inf)
enterococci_thresholds <- c(Excellent = 100, Good = 200, Sufficient = 185, Poor = Inf)

# Compare sites against thresholds
data <- data %>%
  mutate(
    E.coli_quality = case_when(
      `E.coli` <= ec_thresholds["Excellent"] ~ "Excellent",
      `E.coli` <= ec_thresholds["Good"] ~ "Good",
      `E.coli` <= ec_thresholds["Sufficient"] ~ "Sufficient",
      TRUE ~ "Poor"
    ),
    entericEnterococci_quality = case_when(
      entericEnterococci <= enterococci_thresholds["Excellent"] ~ "Excellent",
      entericEnterococci <= enterococci_thresholds["Good"] ~ "Good",
      entericEnterococci <= enterococci_thresholds["Sufficient"] ~ "Sufficient",
      TRUE ~ "Poor"
    )
  )

# Display the updated dataset with water quality categories
data
View(data)
```
```{R}
quality_counts <- data %>%
  group_by(month, E.coli_quality) %>%
  summarise(count = n())
quality_counts_filtered <- quality_counts %>%
  filter(!is.na(month) & !is.na(E.coli_quality))

# E. coli Quality Counts by Month
ggplot(quality_counts_filtered, aes(x = month, y = count, fill = E.coli_quality)) +
  geom_col(position = "dodge") +
  labs(title = "E. coli Quality Classification Counts by Month", y = "Count", x = "Month") +
  scale_fill_manual(values = c("Excellent" = "lightblue", "Good" = "blue", "Sufficient" = "#D2B48C", "Poor" = "brown"))

quality_counts <- data %>%
  group_by(month, entericEnterococci_quality) %>%
  summarise(count = n())
quality_counts_filtered <- quality_counts %>%
  filter(!is.na(month) & !is.na(entericEnterococci_quality))

# Enterococci Quality Counts by Month
ggplot(quality_counts_filtered, aes(x = month, y = count, fill = entericEnterococci_quality)) +
  geom_col(position = "dodge") +
  labs(title = "Enterococci Quality Classification Counts by Month", y = "Count", x = "Month") +
  scale_fill_manual(values = c("Excellent" = "lightblue", "Good" = "blue", "Sufficient" = "#D2B48C", "Poor" = "brown"))
```
#### Figures 10 & 11. These two figures present the monthly distribution of water quality classifications for E. coli and Enterococci, based on contamination thresholds of Excellent (light blue), Good (blue), and Poor (red). In both figures, August exhibits the highest number of Excellent quality counts, while Poor quality levels are consistently observed across July, September, and October. Good quality counts remain relatively low for both bacteria, with slight increases observed in September and October. The figures highlight that August stands out for its superior water quality in terms of E. coli and Enterococci, while Poor classifications are spread more evenly across the other months, especially during mid-summer and early fall.

```{R}
# Summary of findings
cat("Summary of E.coli concentrations across sites:")
summary(data$`E.coli`)

cat("Summary of Enterococci concentrations across sites:")
summary(data$entericEnterococci)

# Average concentrations by Waterway
average_concentrations <- data %>%
  group_by(Waterway) %>%
  summarise(
    Avg_E.coli = mean(`E.coli`, na.rm = TRUE),
    Avg_Enterococci = mean(entericEnterococci, na.rm = TRUE),
    Avg_ESBL = mean(ESBL, na.rm = TRUE),
    Avg_VRE = mean(VRE, na.rm = TRUE)
  )

average_concentrations
```
```{R}
# Summary table of average concentrations by waterway and month
average_concentrations_by_waterway_month <- data %>%
  group_by(Waterway, month) %>%
  summarise(
    Avg_E.coli = mean(`E.coli`, na.rm = TRUE),
    Avg_Enterococci = mean(entericEnterococci, na.rm = TRUE),
    Avg_ESBL = mean(ESBL, na.rm = TRUE),
    Avg_VRE = mean(VRE, na.rm = TRUE)
  )

average_concentrations_by_waterway_month
```
```{R}
# Define thresholds for inland bathing water standards
inland_thresholds <- list(
  E.coli = c(Excellent = 500, Good = 1000, Sufficient = 900, Poor = Inf),
  enterococci = c(Excellent = 200, Good = 400, Sufficient = 330, Poor = Inf)
)

# Replace "NC" with NA in character columns only
data <- data %>%
  mutate(across(where(is.character), ~na_if(., "NC")))

# Filter out rows with NA values for Waterway (or any other relevant column)
data_filtered <- data %>% filter(!is.na(Waterway))

# Function to plot with inland thresholds and log scale
plot_with_thresholds_log <- function(data, y_var, thresholds, title, y_label) {
  ggplot(data, aes(x = month, y = !!sym(y_var), fill = Waterway)) +
    geom_boxplot() +
    geom_hline(yintercept = thresholds["Excellent"], linetype = "dashed", color = "green", linewidth = 1) +
    geom_hline(yintercept = thresholds["Good"], linetype = "dashed", color = "blue", linewidth = 1) +
    geom_hline(yintercept = thresholds["Sufficient"], linetype = "dashed", color = "orange", linewidth = 1) +
    geom_hline(yintercept = max(data[[y_var]], na.rm = TRUE), linetype = "dotted", color = "red", linewidth = 1) +  # Poor line
    scale_y_log10() +  # Apply log scale to y-axis
    labs(title = title, y = y_label, x = "Month") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    annotate("text", x = Inf, y = thresholds["Excellent"], label = "Excellent", color = "green", hjust = 1.1, vjust = -0.5) +
    annotate("text", x = Inf, y = thresholds["Good"], label = "Good", color = "blue", hjust = 1.1, vjust = -0.5) +
    annotate("text", x = Inf, y = thresholds["Sufficient"], label = "Sufficient", color = "orange", hjust = 1.1, vjust = -0.5) +
    annotate("text", x = Inf, y = max(data[[y_var]], na.rm = TRUE), label = "Poor", color = "red", hjust = 1.1, vjust = 2)
}

# E. coli plot with inland thresholds (filtered data)
plot_with_thresholds_log(data_filtered, "E.coli", inland_thresholds$`E.coli`, "E. coli Levels by Waterway and Month", "E. coli (cfu/100ml)")

# Enterococci plot with inland thresholds (filtered data)
plot_with_thresholds_log(data_filtered, "entericEnterococci", inland_thresholds$enterococci, "Enterococci Levels by Waterway and Month", "Enterococci (cfu/100ml)")

# Plot for resistant bacteria (ESBL and VRE) with Site ID (filtered data)
ggplot(data_filtered, aes(x = month, fill = Waterway)) +
  geom_boxplot(aes(y = ESBL, fill = "ESBL"), color = "darkred") +
  geom_boxplot(aes(y = VRE, fill = "VRE"), color = "darkblue", alpha = 0.5) +
  scale_y_log10() +  # Apply log scale to y-axis
  labs(title = "Resistant Bacteria (ESBL & VRE) Levels by Waterway and Month", y = "Concentration (cfu/100ml)", fill = "Bacteria Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
#### Figure 12, 13, 14. Figures 12, 13, and 14 compare bacterial contamination levels across different waterways (Blackwater, Colne, Roman, Stour) by month, highlighting trends for E. coli, Enterococci, and antibiotic-resistant bacteria (ESBL and VRE). In Figure 12, E. coli levels show varying trends, with peaks observed in different waterways across July to October, and thresholds for Excellent, Good, Sufficient, and Poor water quality are marked on the graph. Similarly, Figure 13 presents Enterococci levels by month and waterway, with significant variability between months and waterways, with Blackwater showing elevated levels in July, and Colne in September. Threshold lines for water quality classification are also indicated. Figure 14 focuses on antibiotic-resistant bacteria, comparing ESBL and VRE concentrations across months. While both resistant bacteria types are present, VRE shows a higher concentration, particularly in September.

```{R}
# Define thresholds for inland bathing water standards
inland_thresholds <- list(
  E.coli = c(Excellent = 500, Good = 1000, Sufficient = 900, Poor = Inf),
  enterococci = c(Excellent = 200, Good = 400, Sufficient = 330, Poor = Inf)
)

# Replace "NC" with NA in character columns only
data <- data %>%
  mutate(across(where(is.character), ~na_if(., "NC")))

# Filter out rows with NA values for Waterway (or any other relevant column)
data_filtered <- data %>% filter(!is.na(Waterway))

# Function to plot with inland thresholds and log scale
plot_with_thresholds_log <- function(data, y_var, thresholds, title, y_label) {
  ggplot(data, aes(x = siteID, y = !!sym(y_var), fill = Waterway)) +
    geom_boxplot() +
    geom_hline(yintercept = thresholds["Excellent"], linetype = "dashed", color = "green", linewidth = 1) +
    geom_hline(yintercept = thresholds["Good"], linetype = "dashed", color = "blue", linewidth = 1) +
    geom_hline(yintercept = thresholds["Sufficient"], linetype = "dashed", color = "orange", linewidth = 1) +
    geom_hline(yintercept = max(data[[y_var]], na.rm = TRUE), linetype = "dotted", color = "red", linewidth = 1) +  # Poor line
    scale_y_log10() +  # Apply log scale to y-axis
    labs(title = title, y = y_label, x = "Site ID") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    annotate("text", x = Inf, y = thresholds["Excellent"], label = "Excellent", color = "green", hjust = 1.1, vjust = -0.5) +
    annotate("text", x = Inf, y = thresholds["Good"], label = "Good", color = "blue", hjust = 1.1, vjust = -0.5) +
    annotate("text", x = Inf, y = thresholds["Sufficient"], label = "Sufficient", color = "orange", hjust = 1.1, vjust = -0.5) +
    annotate("text", x = Inf, y = max(data[[y_var]], na.rm = TRUE), label = "Poor", color = "red", hjust = 1.1, vjust = 2)
}

# E. coli plot with inland thresholds (filtered data)
plot_with_thresholds_log(data_filtered, "E.coli", inland_thresholds$`E.coli`, "E. coli Levels by Site ID", "E. coli (cfu/100ml)")

# Enterococci plot with inland thresholds (filtered data)
plot_with_thresholds_log(data_filtered, "entericEnterococci", inland_thresholds$enterococci, "Enterococci Levels by Site ID", "Enterococci (cfu/100ml)")

# Plot for resistant bacteria (ESBL and VRE) with Site ID (filtered data)
ggplot(data_filtered, aes(x = siteID, fill = Waterway)) +
  geom_boxplot(aes(y = ESBL, fill = "ESBL"), color = "darkred") +
  geom_boxplot(aes(y = VRE, fill = "VRE"), color = "darkblue", alpha = 0.5) +
  scale_y_log10() +  # Apply log scale to y-axis
  labs(title = "Resistant Bacteria (ESBL & VRE) Levels by Site ID", y = "Concentration (cfu/100ml)", fill = "Bacteria Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
#### Figure 15,16,17. In Figures 15, 16, and 17, we analyze the concentrations of E. coli, Enterococci, and resistant bacteria (ESBL and VRE) across various site IDs for the Blackwater, Colne, Roman, and Stour waterways. Each figure visualizes bacterial concentration data in cfu/100ml using box plots for individual site IDs, overlaid with water quality thresholds: Excellent, Good, Sufficient, and Poor. In the E. coli figure, high concentrations are observed in sites like Stour (S1, S3) and Colne (C9), surpassing the Poor quality threshold, while most other sites fall within the Sufficient or Good thresholds. Enterococci concentrations follow a similar pattern, with several sites exceeding Poor thresholds, particularly in Stour and Colne, indicating substantial contamination at certain points. Resistant bacteria (ESBL and VRE) show a diverse distribution, with ESBL concentrations significantly higher at some sites (e.g., Hy1 and Hy2) while VRE levels are more sporadic, indicating variability in antibiotic-resistant bacterial presence across sites.

```{R}
# Manually input the data for each sample
data <- data.frame(
  Date = factor(c("25-07-2023", "25-07-2023", "25-07-2023", "10-08-2023", "10-08-2023", "10-08-2023", 
                  "11-10-2023", "11-10-2023", "08-12-2023", "01-03-2024", "27-04-2024"),
                levels = c("25-07-2023", "10-08-2023", "11-10-2023", "08-12-2023", "01-03-2024", "27-04-2024")),
  Enterococci = c(432, 688, 540, 40, 160, 40, 31, 22, NA, 290, 20),
  E_coli = c(820, 1016, 728, 40, 160, 40, 52, 304, 3280, 480, 1410)
)

# Melt the data to long format for ggplot
library(reshape2)
data_long <- melt(data, id.vars = "Date", variable.name = "Bacteria", value.name = "Count")

# Create the boxplot
ggplot(data_long, aes(x = Date, y = Count)) +
  geom_boxplot(aes(fill = Bacteria)) +
  geom_hline(yintercept = 200, linetype = "dashed", color = "green") + # Example threshold for "Excellent"
  geom_hline(yintercept = 400, linetype = "dashed", color = "blue") + # Example threshold for "Good"
  geom_hline(yintercept = 600, linetype = "dashed", color = "orange") + # Example threshold for "Sufficient"
  geom_hline(yintercept = 1000, linetype = "dashed", color = "red") + # Poor threshold
  labs(title = "Bacterial Levels by Date (Site Co_1)", y = "Bacteria Count (cfu/100ml)", x = "Date Collected") +
  facet_wrap(~Bacteria, scales = "free_y") +  # Facet by Bacteria type
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
#### Figure 18. This figure illustrates the bacterial contamination levels of Enterococci and E. coli at Site Co_1 over various sampling dates, with the x-axis displaying the collection dates (from July 2023 to April 2024) and the y-axis representing bacterial counts in cfu/100ml. The left panel shows Enterococci levels in red boxplots, while the right panel presents E. coli levels in teal boxplots. Both panels are overlaid with dashed lines indicating water quality thresholds: green for Excellent, blue for Good, orange for Sufficient, and red for Poor. The highest Enterococci concentrations were observed on 25-07-2023, exceeding the Sufficient threshold, followed by a significant drop on 19-08-2023, with consistently low levels afterward. For E. coli, the highest concentration occurred on 10-08-2023, exceeding the Good threshold, followed by a decrease below the Excellent threshold by 08-12-2023, and a subsequent spike on 27-04-2024 approaching the Poor threshold. The graph effectively visualizes changes in bacterial contamination and fluctuations in water quality at Site Co_1 over time.

```{R}
# Extract relevant columns and convert date to month
data <- data.frame(
  Date = as.Date(c("2023-10-11", "2023-10-11", "2023-07-25", "2023-07-25", "2023-07-25",
                   "2023-08-10", "2023-08-10", "2023-08-10", "2023-10-11", "2023-10-11",
                   "2023-12-08", "2024-03-01", "2024-04-27", "2024-06-06", "2024-07-05"),
                 format = "%Y-%m-%d"),
  Enterococci = c(19, 9, 432, 688, 540, 0, 0, 0, 31, 22, 3280, 290, 20, 560, 200),
  E_coli = c(84, 34, 820, 1016, 728, 0, 0, 0, 52, 304, 0, 480, 2820, 720, 720)
)

# Convert Date to Month
data$Month <- format(data$Date, "%B")

# Melt the data to long format for ggplot
data_long <- melt(data, id.vars = "Month", variable.name = "Bacteria", value.name = "Count")

# Reorder the levels of the Month factor
data_long$Month <- factor(data_long$Month, levels = month.name)

# Create the boxplot
ggplot(data_long, aes(x = Month, y = Count)) +
  geom_boxplot(aes(fill = Bacteria)) +
  geom_hline(yintercept = 200, linetype = "dashed", color = "green") + # Example threshold for "Excellent"
  geom_hline(yintercept = 400, linetype = "dashed", color = "blue") + # Example threshold for "Good"
  geom_hline(yintercept = 600, linetype = "dashed", color = "orange") + # Example threshold for "Sufficient"
  geom_hline(yintercept = 1000, linetype = "dashed", color = "red") + # Poor threshold
  labs(title = "Bacterial Levels by Month (Site Specific)", y = "Bacteria Count (cfu/100ml)", x = "Month") +
  facet_wrap(~Bacteria, scales = "free_y") +  # Facet by Bacteria type
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
#### Figure 19. This figure presents bacterial levels of Enterococci and E. coli over different months at a specific site. The x-axis represents months from March to December, and the y-axis represents the bacterial count in cfu/100ml. The graph consists of three panels: the first for Date (shown in black), the second for Enterococci (green boxplots), and the third for E. coli (blue boxplots). The dashed lines correspond to water quality thresholds: green for Excellent, blue for Good, orange for Sufficient, and red for Poor. The Date panel shows constant values, with all counts around 20,000 cfu/100ml. The Enterococci panel shows concentrations peaking in July and remaining above the Poor threshold by December, while concentrations in other months remain below the Excellent threshold. Similarly, E. coli levels peak in July and gradually decrease by December, with some values exceeding the Poor threshold in August. 

### Discussion- Figures 1-5 illustrate the comparative concentrations of various bacterial contaminants. One key observation is that Colne and Stour exhibit consistently higher contamination levels than Roman and Blackwater, particularly during slack and flood tides. This suggests that the tidal influence plays a significant role in bacterial concentration, with the slack tide showing a potential accumulation of contaminants due to slower water movement. The E. coli concentrations in Stour during slack tide, which surpass the Poor threshold (Figures 6 & 7), further highlight how tidal stagnation can enhance bacterial persistence in water. Additionally, VRE and ESBL levels (Figure 14) were more pronounced in Blackwater and Colne compared to Roman and Stour. This distribution of antibiotic-resistant bacteria (ARB) suggests that certain waterways are more prone to ARB contamination, potentially due to localized sources of pollution, such as wastewater treatment plants or agricultural runoff. Slack tides, in particular, have been shown to reduce water exchange rates, promoting higher concentrations of contaminants. These elevated levels during slack tides could be a function of dilution rates and proximity to contamination sources such as wastewater outfalls. The seasonal analysis in Figures 12-14 reveals clear temporal trends in bacterial contamination. E. coli and Enterococci levels peaked in August, coinciding with warmer temperatures and increased human activity (e.g., recreational water use and agricultural runoff). For example, Figure 20 shows a significant spike in E. coli levels in August at Hy_WWTP_1, likely due to higher effluent discharge rates during periods of increased wastewater processing. Similarly, Enterococci levels at Hy_2 in August indicate heightened contamination from agricultural sources or surface runoff. These results support the notion that summer months, particularly August, are associated with higher bacterial loads due to increased surface runoff, higher temperatures promoting bacterial growth, and potentially higher wastewater discharges. In contrast, the decline in bacterial concentrations in October (Figure 20), particularly at Hy_1 and Hy_2, suggests a seasonal flushing of contaminants or reduced inputs from anthropogenic sources. This pattern underscores the dynamic nature of bacterial contamination in waterways, where environmental factors (e.g., precipitation and temperature) and human activities drive the observed variability. Antibiotic-resistant bacteria, such as VRE and ESBL, were found to vary in concentration across waterways, as shown in Figures 12-14. The higher ESBL levels in Blackwater and Colne than in other waterways suggest that these areas may be receiving inputs from sources such as hospital wastewater, which is known to contain high levels of resistant bacteria. Figure 9, in particular, shows that ESBL concentrations in Blackwater during ebb tide exceed the Poor threshold, which could indicate the persistence and amplification of antibiotic resistance in this area. This pattern highlights a primary public health concern, as resistant bacteria pose a significant challenge regarding water safety and the risk of disease transmission. The presence of ARB in aquatic environments has been increasingly recognized as a severe environmental and public health issue. Studies have shown that antibiotic-resistant bacteria can survive in various environmental settings, such as estuaries and rivers, and their spread is facilitated by human activity and wastewater discharges. Your study's findings further confirm this risk, particularly in urbanized areas like Colne and Blackwater, where human-derived contaminants are likely contributing to the high levels of ARB. Figures 6 and 7 compare E. coli and Total Coliform levels during various tidal phases. Stour consistently exhibits higher E. coli concentrations during slack tide, surpassing the Poor water quality threshold. These elevated E. coli levels signal significant faecal contamination from agricultural runoff, stormwater, or inadequate wastewater treatment. This result is consistent with previous studies that have demonstrated the vulnerability of agricultural catchment areas to faecal pollution, particularly during periods of low water flow or tidal slack. Moreover, Figures 10 and 11 summarize the water quality classifications for E. coli and Enterococci across months, showing August as the month with the highest number of Excellent classifications. This finding could be attributed to variations in sampling locations during August or lower-than-expected contamination in certain areas. However, the predominance of Poor classifications during other months (e.g., September and October) underlines the variability in water quality across time and space. In conclusion, the analysis of bacterial contamination across different waterways, tidal phases, and months reveals significant spatial and temporal variability. The Colne and Stour waterways exhibit consistently higher bacterial concentrations, particularly during slack tides, while Blackwater shows elevated levels of ARB. The peak contamination levels in August highlight the influence of seasonal factors on water quality. Antibiotic-resistant bacteria pose a significant environmental health concern, warranting immediate attention from environmental management agencies and public health authorities.




















